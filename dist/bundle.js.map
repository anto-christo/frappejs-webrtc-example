{"version":3,"file":"bundle.js","sources":["../node_modules/frappejs/webrtc/webrtc.js","../src/js/index.js"],"sourcesContent":["module.exports = class WebRTC {\n\n    constructor(roomName){\n        this.type;\n        this.dataChannel;\n        this.roomName = roomName;\n        this.iceServers = {\n            'iceServers': [{\n                    'url': 'stun:stun.services.mozilla.com'\n                },\n                {\n                    'url': 'stun:stun.l.google.com:19302'\n                }\n            ]\n        };\n        this.rtcPeerConnection = new RTCPeerConnection(this.iceServers);        \n    }\n\n    initConnection(roomName){\n        this.roomName = roomName;\n        this.createDataChannel();\n        this.onIceCandidate(this);\n        this.setupSocketHandlers(this);\n        socket.emit('create or join', this.roomName);\n    }\n\n    onIceCandidate(that){\n        this.rtcPeerConnection.onicecandidate = event => {\n            if (event.candidate) {\n                socket.emit('candidate', {\n                    label: event.candidate.sdpMLineIndex,\n                    id: event.candidate.sdpMid,\n                    candidate: event.candidate.candidate,\n                    room: that.roomName\n                });\n            }\n        }\n    }\n\n    setupSocketHandlers(that){\n        socket.on('created',function(){\n            that.type = 'host';\n        });\n\n        socket.on('joined', function(room) {\n            that.type = 'client';\n            socket.emit('ready',room);\n        });\n\n        socket.on('createOffer',function(room){\n            if(that.type=='host'){\n                that.createOffer(that).then(offer => {\n                    socket.emit('offer',{room:room, offer:offer});\n                });\n            }\n        });\n\n        socket.on('sendOffer',function(event) {\n            if(that.type=='client'){\n                that.createAnswer(that,event.offer).then(answer => {\n                    socket.emit('answer',{room:event.room, answer: answer});\n                });   \n            }\n        });\n\n        socket.on('sendAnswer', function(answer){\n            if(that.type=='host'){\n                that.setHostRemote(answer);\n            }\n        });\n\n        socket.on('candidate', function (event) {\n            var candidate = new RTCIceCandidate({\n                sdpMLineIndex: event.label,\n                candidate: event.candidate\n            });\n            that.rtcPeerConnection.addIceCandidate(candidate);\n        });\n    }\n\n    async createOffer(that) {\n        return await this.rtcPeerConnection.createOffer()\n        .then(desc => {\n            that.rtcPeerConnection.setLocalDescription(desc);\n            return desc;\n        })\n        .catch(e => console.log(e));\n    }\n\n    async createAnswer(that,offer) {\n        this.rtcPeerConnection.setRemoteDescription(new RTCSessionDescription(offer));\n    \n        return await this.rtcPeerConnection.createAnswer()\n            .then(desc => {\n                that.rtcPeerConnection.setLocalDescription(desc);\n                return desc;\n            })\n            .catch(e => console.log(e));\n    }\n\n    setHostRemote(answer){\n        this.rtcPeerConnection.setRemoteDescription(new RTCSessionDescription(answer));\n    }\n\n    createDataChannel(){\n        this.dataChannel = this.rtcPeerConnection.createDataChannel(\"myDataChannel\");\n    \n        this.dataChannel.onerror = function (error) {\n            console.log(\"Data Channel Error:\", error);\n        };\n        \n        this.dataChannel.onopen = function () {\n            console.log(\"The Data Channel is Open\");\n        };\n        \n        this.dataChannel.onclose = function () {\n            console.log(\"The Data Channel is Closed\");\n        };\n\n        this.setupReceiver();\n    }\n\n    setupReceiver(){\n        this.rtcPeerConnection.ondatachannel = event => {\n            const receiveChannel = event.channel;\n            receiveChannel.onmessage = message => this.onDataReceive(message.data);\n        }\n    }\n\n    sendData(data){\n        this.dataChannel.send(data);\n    }\n}","const WebRTC = require('frappejs/webrtc/webrtc');\nvar webRTC = new WebRTC();\n\nvar socket = io();\nwindow.socket = socket;\n\nvar message = document.getElementById(\"message\");\nvar sendBtn = document.getElementById(\"send\");\nvar messageList = document.getElementById(\"messageList\");\n\nvar id = prompt(\"Enter Name of Room:\");\nwebRTC.initConnection(id);\n\nsendBtn.onclick = function(){\n    var text = message.value;\n    webRTC.sendData(text);\n    var div = document.createElement(\"div\");\n    div.setAttribute(\"style\",\"border:0.5px solid grey; margin:1%; padding:1%\");\n    var data = document.createTextNode(\"You : \"+text);\n    div.appendChild(data);\n    messageList.appendChild(div);\n}\n\nwebRTC.onDataReceive = data => {\n    var div = document.createElement(\"div\");\n    div.setAttribute(\"style\",\"border:0.5px solid grey; margin:1%; padding:1%\");\n    var data = document.createTextNode(\"Sender : \"+data);\n    div.appendChild(data);\n    messageList.appendChild(div);\n};"],"names":["socket"],"mappings":"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"}